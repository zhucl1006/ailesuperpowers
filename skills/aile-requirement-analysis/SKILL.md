---
name: aile-requirement-analysis
description: 面向团队工作流的需求接入技能（阶段2）。读取 Jira Story 的需求与 UI 示意，结构化输出需求摘要/风险/隐含需求，并（可选）回写 Jira Comment。
---

# Aile：需求接入（aile-requirement-analysis）

## 来源原 Skill

- 来源：superpowers 需求澄清能力（已迁移为 aile-only）
- 策略：保留“单问题推进 + 结构化分析”流程，并增强 Jira Story 接入契约。

## 概述

本技能用于阶段 2 的第一步：把 Jira Story 的输入（需求描述、UI 示意、约束）转成可用于计划与设计的结构化材料。

## Skill流程

**理解這個想法：**
- 首先檢查當前專案狀態（文件、文件、最近提交）
- 一次提出一個問題來完善想法
- 盡可能選擇多項選擇題，但開放式問題也可以
- 每個訊息只有一個問題 - 如果某個主題需要更多探索，請將其分解為多個問題
- 重點理解：目的、約束、成功標準

**探索方法：**
- 提出 2-3 種不同的權衡方法
- 透過對話方式提出選項以及您的建議和推理
- 以您推薦的選項開頭並解釋原因

**展示設計：**
- 一旦您相信自己瞭解了自己正在構建的內容，就可以展示設計
- 將其分成200-300字的部分
- 在每個部分之後詢問到目前為止看起來是否正確
- 涵蓋：架構、組件、數據流、錯誤處理、測試
- 如果有些事情沒有意義，準備回去澄清

## Skill設計後

**文件：**
- 將經過驗證的設計寫入`docs/plans/{Story-Key}/analysis.md`
- 如果可以的話，使用風格元素：清晰簡潔的寫作技巧
- 將設計文檔提交到git

**實施（如果繼續）：**
- 問：“準備好實施了嗎？”
- 使用超能力：aile-git-worktrees 創建隔離的工作區
- 使用超能力：aile-writing-plans 制定詳細的實施計劃

## Skill關鍵原則

- **一次一個問題** - 不要因多個問題而不知所措
- **首選多項選擇** - 如果可能的話，比開放式更容易回答
- **YAGNI 無情** - 從所有設計中刪除不必要的功能
- **探索替代方案** - 在解決之前始終提出 2-3 種方法
- **增量驗證** - 分部分展示設計，驗證每個部分
- **保持靈活性** - 當某些事情沒有意義時返回並澄清

## 输入

- Jira Story：Description、Acceptance Criteria（如有）、附件/链接（UI 示意）
-（可选）相关 Epic / 依赖 Story
-（可选）产品名称（用于 Google Drive 目录路由）

## 核心产出契约（必须遵守）
1. 计划文件必须落在：`docs/plans/{Story-Key}/analysis.md`
2. 文件必须包含：
   - 需求理解与风险
   - 用户路径/核心交互
   - 验收条件（AC）初稿：将业务表述改写成可测试条目
   - 隐含需求清单（例如权限、空状态、错误状态、性能/兼容性）
   - 建议的阶段 2 下一步：是否需要 Pencil 设计、是否需要拆子任务
3. 必须输出“规格回补评估”：
   - 是否需要回补规格文件：是/否
   - 回补文件清单（若为“是”，列出文件路径与回补原因）
4. 若评估为“需要回补”，必须先回补对应规格文件，再触发 Google Drive 同步
5. 目录路由与上传策略遵循：`docs-templates/google-drive-sync-integration.md`

## Jira MCP（可选）

若环境提供 Jira MCP Tool（例如 `mcp-atlassian`），按以下步骤执行：

1. 读取 Story：`jira_get_issue`
2. 将“需求接入摘要”写入 Comment：`jira_add_comment`

> 注意：凭据（API Token）必须通过环境变量注入，不得写入仓库。

## Google Drive 同步（可选，团队推荐启用）

若环境提供 `google-drive` Skill，且本次分析判定“需要回补规格文件”，按以下步骤执行：

1. 基于 Story 分析输出“规格回补评估”，确定需要回补的规格文件
2. 回补已判定的规格文件（只处理本次变更文件）
3. 先分析判断产品归属（结合 Story 内容、项目文档、工程命名），再路由目录：
   - Aile：`公用云端硬碟/NewAile文件/02-功能規格/[工程名字]`
   - AiPool：`公用云端硬碟/AiPool文件/02-功能規格/[工程名字]`
   - 无法确定：先询问用户确认目标目录
4. `[工程名字]` 默认取当前工作目录名；若用户指定工程名则以用户输入为准
5. 同步范围规则：
   - 默认候选 `docs/**/*.md`，排除 `docs/plans/**`
   - 仅同步判定为规格文件且本次已回补的文件
   - 已知目录优先映射：
     - `docs/specs/**/*.md` -> `.../[工程名字]/specs`
     - `docs/modules/**/*.md` -> `.../[工程名字]/modules`
     - `docs/guides/**/*.md` -> `.../[工程名字]/guides`
     - `docs/database/**/*.md` -> `.../[工程名字]/database`
     - `docs/api/**/*.md` -> `.../[工程名字]/api`
   - `docs/` 下其他目录：若判定为规格文件，保留相对目录结构同步到 `.../[工程名字]/{relative-dir}`
6. 上传前执行同名文件轮替：
   - 旧文件重命名为历史版本
   - 上传新文件
   - 仅保留最近 5 个历史版本
7. 强制定位规则：
   - 禁止全局名称搜索根目录，必须从固定根目录 ID（Aile/AiPool）逐层定位到目标目录
   - 上传时必须显式指定目标目录 ID
   - 上传后必须校验文件父目录；若不一致，判定失败并转人工补传
8. 所有 Drive 操作必须通过 `google-drive` Skill 执行，禁止自定义脚本/API 直连
9. 若权限不足或上传失败：
   - 明确说明失败原因
   - 提示用户确认 `google-drive` Skill 登录账号是否正确，并检查共享盘权限
   - 降级为“本地文档已更新 + 人工补传待办”

## 执行流程

1. 获取 Story Key
2. 读取并复述需求（避免理解偏差）
3. 列出不确定项（一次一个问题，优先多选题）
4. 产出结构化摘要以及analysis.md分析文件（参考 `docs-templates/stage2-analysis-template.md`）
5. 输出“规格回补评估”（是否需要回补 + 回补文件清单）
6. 若需要回补规格文件：先回补文档，再触发 Google Drive 同步
7. （可选）回写 Jira Comment
8. （可选）触发 Google Drive 同步，按统一指南执行目录路由、规格判定与历史版本策略
