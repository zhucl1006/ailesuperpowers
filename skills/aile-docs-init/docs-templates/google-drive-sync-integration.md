# Google Drive 同步规则（aile-docs-init）

> 本文件放在 Skill 目录下，供运行环境无法访问项目根目录文档时直接读取。

## 1. 适用范围

- 仅用于 `aile-docs-init`。
- 场景：文档生成后自动同步 `specs/modules` 到产品目录。

## 2. 产品识别与目录路由

- 先做产品归属分析判断（结合需求描述、现有文档、工程命名）。
- 判断为 Aile：
  - 根目录：`公用云端硬碟/NewAile文件/02-功能規格/[工程名字]`
  - 规格目录：`.../[工程名字]/specs`
  - 模块目录：`.../[工程名字]/modules`
- 判断为 AiPool：
  - 根目录：`公用云端硬碟/AiPool文件/02-功能規格/[工程名字]`
  - 规格目录：`.../[工程名字]/specs`
  - 模块目录：`.../[工程名字]/modules`
- 无法确定：必须先询问用户确认目标目录。

### 2.1 固定云盘位置（必须）

- 共享盘入口（公用云端硬碟）：`https://drive.google.com/drive/u/0/shared-drives`
- Aile 根目录（NewAile文件）：`https://drive.google.com/drive/u/0/folders/1u2I7QtOQDzWnQAVgINZqQbLv0wOjvR_0`
- AiPool 根目录（AiPool文件）：`https://drive.google.com/drive/u/0/folders/12nxdtruC9WtZlDRL58SCxb0BuWUSibqv`
- 所有文档必须从上述根目录继续进入 `02-功能規格/[工程名字]/specs|modules`，禁止上传到“我的云端硬碟”或其他同名目录。

### 2.2 操作约束（必须通过 Skill）

- 所有 Google Drive 的查询、建目录、重命名、上传、清理操作，必须通过 `google-drive` Skill 执行。
- 禁止自行编写脚本、直接调用 Drive API、或使用其他未约定方法操作云盘。
- 若 `google-drive` Skill 不可用，必须提示用户检查登录账号和权限，并降级为人工补传。

### 2.3 强制定位策略（避免写入“我的云端硬碟”）

- 禁止用全局名称搜索定位根目录（例如直接按 `NewAile文件` 或 `AiPool文件` 全盘搜索）。
- 必须从固定根目录 ID 开始定位：
  - Aile 根目录 ID：`1u2I7QtOQDzWnQAVgINZqQbLv0wOjvR_0`
  - AiPool 根目录 ID：`12nxdtruC9WtZlDRL58SCxb0BuWUSibqv`
- 必须基于父目录 ID 逐层定位/创建：
  - `02-功能規格` -> `[工程名字]` -> `specs` / `modules` / `guides` / `database` / `api`
- 所有上传必须显式指定目标目录 ID（folder/parent），禁止无父目录上传。
- 上传完成后必须校验文件父目录：
  - 若父目录不在目标目录 ID 下，判定为失败，不得宣称上传成功，并提示用户人工纠偏。
## 3. 工程名字规则

- `[工程名字]` 默认取当前工作目录名。
- 若用户明确指定工程名，优先使用用户输入。

## 4. 同步范围

### 4.1 候选范围

- 默认候选：`docs/**/*.md`
- 明确排除：`docs/plans/**`（执行计划文件禁止上传到规格目录）

### 4.2 规格文件判定（必须先分析）

对每个候选文件先分析是否属于“工程规格文件”，只有判定为“是”才允许同步。  
判定依据（满足其一即可）：
- 描述产品需求、架构设计、模块职责、接口契约、数据库结构、开发规范、测试规范
- 内容可作为团队实现/评审/验收依据，而非执行过程记录

默认判定为“非规格文件”的典型示例：
- 执行计划、过程追踪、临时记录、会议纪要、日报周报、试点复盘流水

### 4.3 同步落位规则

- 已知规格目录（优先）：
  - `docs/specs/**/*.md` -> `.../[工程名字]/specs`
  - `docs/modules/**/*.md` -> `.../[工程名字]/modules`
  - `docs/guides/**/*.md` -> `.../[工程名字]/guides`
  - `docs/database/**/*.md` -> `.../[工程名字]/database`
  - `docs/api/**/*.md` -> `.../[工程名字]/api`
- `docs/` 下其他目录：
  - 若分析判定为规格文件，则保留相对目录结构同步到 `.../[工程名字]/{relative-dir}`
  - 若判定为非规格文件，则不上传

## 5. 上传与版本策略

1. 先查找同名文件。
2. 若同名文件存在，旧文件重命名为历史版本（建议后缀：`.history-YYYYMMDD-HHmmss`）。
3. 上传新文件（保留原文件名）。
4. 历史版本仅保留最近 5 个，超出部分删除。

约束：
- 只清理历史文件，不删除当前最新文件。
- 不允许直接覆盖导致历史丢失。

## 6. 失败兜底

若调用 `google-drive` Skill 失败或权限不足：

1. 明确输出失败原因。
2. 提示用户确认 `google-drive` Skill 登录账号是否正确，并检查共享盘访问权限。
3. 降级为“本地文档已生成 + 人工补传待办”，不得声称已上传成功。
